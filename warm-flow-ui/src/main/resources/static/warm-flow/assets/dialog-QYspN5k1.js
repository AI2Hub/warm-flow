import{g as X,u as Z,a as ee}from"./leave-Cz5vLoQ-.js";import{l as le}from"./user-Bu1ajp0e.js";import{r as y,C as ae,J as te,d,o as p,c as w,h as e,l as v,f as l,m as ne,p as k,n as T,e as a,K as C,L as U,D as S,B as oe,v as ue}from"./index-CHQH9-TC.js";const se={class:"app-container"},de={class:"dialog-footer"},re=oe({name:"Dialog"}),_e=Object.assign(re,{emits:["refresh"],setup(ie,{expose:F,emit:L}){const{proxy:b}=ue(),{flow_status:me,leave_type:N}=b.useDict("flow_status","leave_type"),f=y(!1),s=y(!1),R=y(""),x=y([]),g=y(""),q=ae({form:{type:null,reason:null,startTime:null,endTime:null,day:null,flowStatus:null,additionalHandler:[]},rules:{type:[{required:!0,message:"请假类型不能为空",trigger:"change"}],reason:[{required:!0,message:"请假原因不能为空",trigger:"blur"}],startTime:[{required:!0,message:"开始时间不能为空",trigger:"blur"},{validator:Y,trigger:"change"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"blur"},{validator:Y,trigger:"change"}],day:[{required:!0,message:"请假天数不能为空",trigger:"blur"},{validator:E,trigger:"blur"}]}}),H=L,{form:t,rules:I}=te(q);function $(){le().then(r=>{let n={label:"用户",options:r.rows.map(u=>({value:u.userId,label:u.nickName}))};x.value.push(n)})}async function z(r,n,u){W(),s.value=n,r&&await X(r).then(m=>{t.value=m.data}),f.value=!0,s.value?u.value="详情":r?u.value=u||"修改":u.value="新增"}function Y(r,n,u){const{startTime:m,endTime:i}=t.value;m&&i&&new Date(m)>new Date(i)?u(new Error("开始时间不能晚于结束时间")):u()}function E(r,n,u){const{startTime:m,endTime:i,day:c}=t.value;if(m&&i){const _=new Date(i)-new Date(m),V=Math.ceil(_/(1e3*60*60*24))+1;c!=V?u(new Error("请假天数应等于结束时间和开始时间之间的天数差")):u()}else u()}function W(){t.value={id:null,tenantId:null,type:null,reason:null,startTime:null,endTime:null,day:null,instanceId:null,nodeCode:null,nodeName:null,flowStatus:null,createBy:null,createTime:null,updateBy:null,updateTime:null,delFlag:null},s.value=!1,g.value="",b.resetForm("leaveRef")}function B(){if(t.value.startTime&&t.value.endTime){const r=new Date(t.value.startTime),n=new Date(t.value.endTime),u=Math.abs(n-r),m=Math.ceil(u/(1e3*60*60*24))+1;t.value.day=m}else t.value.day=""}function j(){b.$refs.leaveRef.validate(r=>{r&&(t.value.id!=null?Z(t.value).then(()=>{b.$modal.msgSuccess("修改成功"),f.value=!1,H("refresh")}):ee(t.value,g.value).then(()=>{b.$modal.msgSuccess("新增成功"),f.value=!1,H("refresh")}))})}return $(),F({show:z}),(r,n)=>{const u=d("el-option"),m=d("el-select"),i=d("el-form-item"),c=d("el-col"),_=d("el-row"),V=d("el-input"),M=d("el-date-picker"),J=d("el-input-number"),K=d("WarningFilled"),O=d("el-icon"),A=d("el-tooltip"),G=d("el-option-group"),P=d("el-form"),D=d("el-button"),Q=d("el-dialog");return p(),w("div",se,[e(f)?(p(),v(Q,{key:0,title:e(R),modelValue:e(f),"onUpdate:modelValue":n[8]||(n[8]=o=>S(f)?f.value=o:null),width:"800px","append-to-body":""},{footer:l(()=>[ne("div",de,[e(s)?T("",!0):(p(),v(D,{key:0,onClick:n[7]||(n[7]=o=>f.value=!1)},{default:l(()=>[k("取消")]),_:1})),e(s)?T("",!0):(p(),v(D,{key:1,type:"primary",onClick:j},{default:l(()=>[k("确定")]),_:1})),e(s)?(p(),v(D,{key:2,type:"primary",onClick:r.handleSubmit},{default:l(()=>[k("提交审批")]),_:1},8,["onClick"])):T("",!0)])]),default:l(()=>[a(P,{ref:"leaveRef",model:e(t),rules:e(I),"label-width":"110px",disabled:e(s)},{default:l(()=>[a(_,null,{default:l(()=>[a(c,{span:12},{default:l(()=>[a(i,{label:"请假类型",prop:"type"},{default:l(()=>[a(m,{modelValue:e(t).type,"onUpdate:modelValue":n[0]||(n[0]=o=>e(t).type=o),placeholder:"请选择请假类型",filterable:"",disabled:e(s)},{default:l(()=>[(p(!0),w(C,null,U(e(N),o=>(p(),v(u,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(_,null,{default:l(()=>[a(c,{span:24},{default:l(()=>[a(i,{label:"请假原因",prop:"reason"},{default:l(()=>[a(V,{modelValue:e(t).reason,"onUpdate:modelValue":n[1]||(n[1]=o=>e(t).reason=o),type:"textarea",placeholder:"请输入内容",disabled:e(s)},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(_,null,{default:l(()=>[a(c,{span:12},{default:l(()=>[a(i,{label:"开始时间",prop:"startTime"},{default:l(()=>[a(M,{clearable:"",size:"small",modelValue:e(t).startTime,"onUpdate:modelValue":n[2]||(n[2]=o=>e(t).startTime=o),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"选择开始时间",onChange:B,disabled:e(s)},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(c,{span:12},{default:l(()=>[a(i,{label:"结束时间",prop:"endTime"},{default:l(()=>[a(M,{clearable:"",size:"small",modelValue:e(t).endTime,"onUpdate:modelValue":n[3]||(n[3]=o=>e(t).endTime=o),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"选择结束时间",onChange:B,disabled:e(s)},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(_,null,{default:l(()=>[a(c,{span:12},{default:l(()=>[a(i,{label:"请假天数",prop:"day"},{default:l(()=>[a(J,{modelValue:e(t).day,"onUpdate:modelValue":n[4]||(n[4]=o=>e(t).day=o),placeholder:"请输入请假天数","controls-position":"right",min:0,disabled:e(s)},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),a(_,null,{default:l(()=>[a(i,{label:"自定义流程状态",prop:"flowStatus"},{default:l(()=>[a(V,{modelValue:e(g),"onUpdate:modelValue":n[5]||(n[5]=o=>S(g)?g.value=o:null)},null,8,["modelValue"])]),_:1}),a(A,{class:"item",effect:"dark",content:"warm-flow工作流默认内置了一套流程状态，如果此字段填写可以自定义流程状态"},{default:l(()=>[a(O,{size:14,class:"ml5 mt10"},{default:l(()=>[a(K)]),_:1})]),_:1})]),_:1}),a(_,null,{default:l(()=>[a(c,{span:12},{default:l(()=>[a(i,{label:"抄送人",prop:"additionalHandler"},{default:l(()=>[a(m,{modelValue:e(t).additionalHandler,"onUpdate:modelValue":n[6]||(n[6]=o=>e(t).additionalHandler=o),multiple:"","collapse-tags":"",disabled:e(s),clearable:!e(s),filterable:"",placeholder:"请选择抄送人员"},{default:l(()=>[(p(!0),w(C,null,U(e(x),o=>(p(),v(G,{key:o.label,label:o.label,disabled:e(s)},{default:l(()=>[(p(!0),w(C,null,U(o.options,h=>(p(),v(u,{key:h.value,label:h.label,value:h.value},null,8,["label","value"]))),128))]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue","disabled","clearable"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1},8,["title","modelValue"])):T("",!0)])}}});export{_e as default};
