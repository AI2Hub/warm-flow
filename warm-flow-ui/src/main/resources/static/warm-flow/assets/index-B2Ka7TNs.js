import{r as n,C as le,J as te,d as r,G as oe,o as m,c as U,H as k,I as z,h as e,e as l,f as a,k as D,K as ae,L as ne,l as g,p as v,z as K,m as $,D as se,bN as ie,n as re,B as ue,v as pe}from"./index-CHQH9-TC.js";import{c as me,i as ce}from"./execute-Dmqi2dJm.js";import{j as de}from"./definition-CAAY_8pD.js";import fe from"./selectUser-BkUDpbL9.js";import"./user-Bu1ajp0e.js";const _e={class:"app-container"},ge=["src"],ve=ue({name:"Notice"}),Ce=Object.assign(ve,{setup(we){const{proxy:w}=pe(),{flow_status:q}=w.useDict("flow_status"),h=n(!0),C=n(""),P=n(!1),B=n([]),F=n(!0),j=n(!0),L=n(!0),b=n(0),T=n([]),O=n(null),x=n(""),y=n(""),d=n(""),N=n(!1),J=le({queryParams:{pageNum:1,pageSize:10,nodeName:null,flowStatus:null,approver:null,flowName:null,createTime:null},form:{},rules:{assigneePermission:[{required:!0,message:"请选择",trigger:"change"}]},postParams:{}}),{queryParams:i,form:V,rules:he,postParams:R}=te(J);function c(){h.value=!0,me(i.value).then(s=>{T.value=s.rows,b.value=s.total,h.value=!1})}function f(){i.value.pageNum=1,c()}function A(){w.resetForm("queryForm"),f()}function H(s){B.value=s.map(o=>o.id),F.value=s.length!==1,j.value=!s.length}function Q(s){de(s).then(o=>{P.value=!0,C.value="data:image/gif;base64,"+o.data})}function E(s){V.value.assigneePermission=s.map(p=>p.userId);let o=JSON.parse(JSON.stringify(V.value.assigneePermission)),_={转办:"2",加签:"6",委派:"3",减签:"7"};ce(x.value,Array.isArray(o)?o.join(","):o,_[d.value]).then(()=>{w.$modal.msgSuccess(`${d.value}成功`),c()})}return c(),(s,o)=>{const _=r("el-input"),p=r("el-form-item"),G=r("el-option"),M=r("el-select"),S=r("el-button"),W=r("el-form"),u=r("el-table-column"),X=r("dict-tag"),Y=r("el-table"),Z=r("pagination"),I=r("el-dialog"),ee=oe("loading");return m(),U("div",_e,[k(l(W,{model:e(i),ref:"queryForm",size:"small",inline:!0,"label-width":"100px"},{default:a(()=>[l(p,{label:"任务名称",prop:"nodeName"},{default:a(()=>[l(_,{modelValue:e(i).nodeName,"onUpdate:modelValue":o[0]||(o[0]=t=>e(i).nodeName=t),placeholder:"请输入任务名称",clearable:"",onKeyup:D(f,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),l(p,{label:"流程状态",prop:"flowStatus"},{default:a(()=>[l(M,{modelValue:e(i).nodeType,"onUpdate:modelValue":o[1]||(o[1]=t=>e(i).nodeType=t),placeholder:"请选择流程状态",clearable:""},{default:a(()=>[(m(!0),U(ae,null,ne(e(q),t=>(m(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"抄送人",prop:"flowName"},{default:a(()=>[l(_,{modelValue:e(i).flowName,"onUpdate:modelValue":o[2]||(o[2]=t=>e(i).flowName=t),placeholder:"请输入任抄送人",onKeyup:D(f,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),l(p,null,{default:a(()=>[l(S,{type:"primary",icon:"el-icon-search",size:"small",onClick:f},{default:a(()=>[v("搜索")]),_:1}),l(S,{icon:"el-icon-refresh",size:"small",onClick:A},{default:a(()=>[v("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[z,e(L)]]),k((m(),g(Y,{data:e(T),onSelectionChange:H},{default:a(()=>[l(u,{type:"selection",width:"55",align:"center",fixed:""}),l(u,{label:"序号",width:"55",align:"center",key:"id",prop:"id"},{default:a(t=>[v(K(t.$index+1),1)]),_:1}),l(u,{label:"流程实例id",width:"100",align:"center",prop:"id","show-overflow-tooltip":!0}),l(u,{label:"流程名称",align:"center",prop:"flowName","show-overflow-tooltip":!0}),l(u,{label:"任务名称",align:"center",prop:"nodeName","show-overflow-tooltip":!0}),l(u,{label:"抄送人",align:"center",prop:"approver","show-overflow-tooltip":!0}),l(u,{label:"流程状态",align:"center",prop:"flowStatus","show-overflow-tooltip":!0},{default:a(t=>[l(X,{options:s.dict.type.flow_status,value:t.row.flowStatus},null,8,["options","value"])]),_:1}),l(u,{label:"创建时间",align:"center",prop:"createTime",width:"160","show-overflow-tooltip":!0},{default:a(t=>[$("span",null,K(s.parseTime(t.row.createTime)),1)]),_:1}),l(u,{label:"操作",align:"center",width:"240",fixed:"right","class-name":"small-padding fixed-width"},{default:a(t=>[l(S,{size:"small",type:"text",onClick:be=>Q(t.row.id)},{default:a(()=>[v("流程图")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,e(h)]]),k(l(Z,{total:e(b),page:e(i).pageNum,limit:e(i).pageSize,onPagination:c},null,8,["total","page","limit"]),[[z,e(b)>0]]),(m(),g(ie(e(O)),{modelValue:e(y),"onUpdate:modelValue":o[3]||(o[3]=t=>se(y)?y.value=t:null),taskId:e(x),onRefresh:c},null,40,["modelValue","taskId"])),l(I,{title:"流程图",visible:e(P),width:"80%"},{default:a(()=>[$("img",{src:e(C),width:"100%",style:{margin:"0 auto"}},null,8,ge)]),_:1},8,["visible"]),e(N)?(m(),g(I,{key:0,title:`${e(d)}用户选择`,visible:e(N),width:"80%","append-to-body":""},{default:a(()=>[l(e(fe),{postParams:e(R),type:e(d),selectUser:e(V).assigneePermission,userVisible:e(N),onHandleUserSelect:E},null,8,["postParams","type","selectUser","userVisible"])]),_:1},8,["title","visible"])):re("",!0)])}}});export{Ce as default};
