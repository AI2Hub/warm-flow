import{a as ie,r as i,C as ce,J as pe,w as Y,d as c,G as me,o as m,c as F,e as s,f as r,m as A,h as a,D as J,H as K,k as j,p as C,I as M,K as fe,L as he,l as h,z as O,bO as ve,n as _,B as be,v as ke}from"./index-CHQH9-TC.js";import{d as _e,b as ye}from"./user-Bu1ajp0e.js";const ge={class:"app-container"},Ie={class:"head-container"},Ce={class:"head-container"},xe=be({name:"User"}),Se=Object.assign(xe,{props:{userVisible:{type:Boolean},selectUser:{type:Array},postParams:{type:Object},type:{type:String}},emits:["update:userVisible","handleUserSelect"],setup(B,{emit:Q}){ie();const{proxy:y}=ke();y.useDict("sys_normal_disable","sys_user_sex");const x=B,p=i([]);i(!1);const N=i(!0),G=i(!0),S=i(0);i("");const g=i([]),w=i(""),E=i(void 0);i(void 0),i([]),i([]);const b=i([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),u=i([]),H=ce({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:"0",deptId:void 0},checkAllInfo:{isIndeterminate:!1,isChecked:!1}}),{queryParams:d,form:we,checkAllInfo:k}=pe(H),P=Q,W=(l,e)=>l?e.label.indexOf(l)!==-1:!0;Y(w,l=>{y.$refs.deptTreeRef.filter(l)}),Y(()=>x.selectUser,(l,e)=>{e?y.$nextTick(()=>{u.value=u.value.filter(t=>{let o=l?l.findIndex(f=>f===t.userId):-1;return p.value.forEach(f=>{f.userId===t.userId&&(f.isChecked=o!==-1)}),o!==-1})}):u.value=[]},{deep:!0,immediate:!0});function X(){_e().then(l=>{E.value=l.data})}function U(){N.value=!0;let l=y.addDateRange(d.value,g.value),e="listUser";if(x.type){let t=JSON.parse(JSON.stringify(x.postParams));e=t.url,delete t.url,l={...t,deptId:d.value.deptId}}ye[e](l).then(t=>{N.value=!1,S.value=t.total,t.rows.forEach(o=>{o.isChecked=u.value.findIndex(f=>f.userId===o.userId)!==-1}),p.value=t.rows,R()})}function Z(l){d.value.deptId=l.id,I()}function I(){d.value.pageNum=1,U()}function ee(){g.value=[],y.resetForm("queryRef"),d.value.deptId=void 0,y.$refs.deptTreeRef.setCurrentKey(null),I()}function R(){const l=p.value.length;let e=0;p.value.map(t=>{t.isChecked&&(e+=1)}),k.value.isChecked=l===e&&l>0,k.value.isIndeterminate=e>0&&e<l}function le(){const l=u.value;k.value.isIndeterminate=!1,k.value.isChecked?p.value=p.value.map(e=>(e.isChecked=!0,u.value.findIndex(t=>t.userId===e.userId)===-1&&l.push({userId:e.userId}),e)):p.value=p.value.map(e=>{e.isChecked=!1;let t=l.findIndex(o=>o.userId===e.userId);return t!==-1&&l.splice(t,1),e}),u.value=l}function L(l){if(["转办","委派"].includes(x.type))p.value.forEach(e=>{e.userId===l.userId?e.isChecked=!0:e.isChecked=!1}),u.value=[{userId:l.userId}];else{p.value.forEach(t=>{t.userId===l.userId&&(t.isChecked=!t.isChecked)});const e=[...u.value];if(l.isChecked)e.push({userId:l.userId});else{const t=e.findIndex(o=>o.userId===l.userId);t!==-1&&e.splice(t,1)}u.value=e,R()}}function te(l){p.value.forEach(o=>{o.userId===l&&(o.isChecked=!o.isChecked)});const e=u.value,t=e.findIndex(o=>o.userId===l);t!==-1&&e.splice(t,1),u.value=e,R()}function ae(){P("update:userVisible",!1)}function ne(){P("handleUserSelect",u.value),ae()}return X(),U(),(l,e)=>{const t=c("el-input"),o=c("el-tree"),f=c("el-col"),V=c("el-form-item"),se=c("el-date-picker"),T=c("el-button"),re=c("el-form"),$=c("el-tag"),q=c("el-row"),z=c("el-checkbox"),v=c("el-table-column"),oe=c("el-table"),ue=c("pagination"),de=me("loading");return m(),F("div",ge,[s(q,{gutter:20},{default:r(()=>[s(f,{span:4,xs:24},{default:r(()=>[A("div",Ie,[s(t,{modelValue:a(w),"onUpdate:modelValue":e[0]||(e[0]=n=>J(w)?w.value=n:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),A("div",Ce,[s(o,{data:a(E),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":W,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:Z},null,8,["data"])])]),_:1}),s(f,{span:20,xs:24},{default:r(()=>[K(s(re,{model:a(d),ref:"queryRef",inline:!0,"label-width":"68px"},{default:r(()=>[s(V,{label:"用户名称",prop:"userName"},{default:r(()=>[s(t,{modelValue:a(d).userName,"onUpdate:modelValue":e[1]||(e[1]=n=>a(d).userName=n),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:j(I,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),s(V,{label:"手机号码",prop:"phonenumber"},{default:r(()=>[s(t,{modelValue:a(d).phonenumber,"onUpdate:modelValue":e[2]||(e[2]=n=>a(d).phonenumber=n),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:j(I,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),s(V,{label:"创建时间",style:{width:"308px"}},{default:r(()=>[s(se,{modelValue:a(g),"onUpdate:modelValue":e[3]||(e[3]=n=>J(g)?g.value=n:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),s(V,null,{default:r(()=>[s(T,{type:"primary",icon:"Search",onClick:I},{default:r(()=>[C("搜索")]),_:1}),s(T,{icon:"Refresh",onClick:ee},{default:r(()=>[C("重置")]),_:1}),s(T,{type:"primary",disabled:a(u).length===0,onClick:ne},{default:r(()=>[C("确 定")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),[[M,a(G)]]),s(q,{gutter:10,class:"mb8"},{default:r(()=>[(m(!0),F(fe,null,he(a(u),n=>(m(),h($,{type:"primary",style:{"margin-right":"10px"},key:n.userId,closable:"",onClose:D=>te(n.userId)},{default:r(()=>[C(O(n.userId),1)]),_:2},1032,["onClose"]))),128))]),_:1}),K((m(),h(oe,{data:a(p),onRowClick:L},{default:r(()=>[s(v,{width:"50",align:"center"},ve({default:r(n=>[s(z,{modelValue:n.row.isChecked,"onUpdate:modelValue":D=>n.row.isChecked=D,onChangeCapture:e[5]||(e[5]=D=>L(l.row))},null,8,["modelValue","onUpdate:modelValue"])]),_:2},[["转办","委派"].includes(B.type)?void 0:{name:"header",fn:r(()=>[s(z,{indeterminate:a(k).isIndeterminate,modelValue:a(k).isChecked,"onUpdate:modelValue":e[4]||(e[4]=n=>a(k).isChecked=n),onChange:le},null,8,["indeterminate","modelValue"])]),key:"0"}]),1024),a(b)[0].visible?(m(),h(v,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):_("",!0),a(b)[1].visible?(m(),h(v,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):_("",!0),a(b)[2].visible?(m(),h(v,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):_("",!0),a(b)[3].visible?(m(),h(v,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):_("",!0),a(b)[4].visible?(m(),h(v,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):_("",!0),a(b)[5].visible?(m(),h(v,{label:"状态",align:"center",key:"status"},{default:r(n=>[s($,{type:n.row.status==="0"?"":"warning"},{default:r(()=>[C(O(n.row.status==="0"?"正常":"停用"),1)]),_:2},1032,["type"])]),_:1})):_("",!0),a(b)[6].visible?(m(),h(v,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:r(n=>[A("span",null,O(l.parseTime(n.row.createTime)),1)]),_:1})):_("",!0)]),_:1},8,["data"])),[[de,a(N)]]),K(s(ue,{style:{"margin-bottom":"35px"},total:a(S),page:a(d).pageNum,"onUpdate:page":e[6]||(e[6]=n=>a(d).pageNum=n),limit:a(d).pageSize,"onUpdate:limit":e[7]||(e[7]=n=>a(d).pageSize=n),onPagination:U},null,8,["total","page","limit"]),[[M,a(S)>0]])]),_:1})]),_:1})])}}});export{Se as default};
