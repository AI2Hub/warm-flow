import{r as s,C as me,J as pe,d,G as F,o as r,c as L,H as g,I as R,h as l,e as o,f as n,k as ce,K as fe,L as ve,l as m,p,z as H,m as K,n as I,D as N,bN as ge,B as _e,v as we,bS as he}from"./index-CHQH9-TC.js";import{t as ye,g as be,i as ke,b as Ce,u as Se}from"./execute-Dmqi2dJm.js";import{j as Ve}from"./definition-CAAY_8pD.js";import Pe from"./selectUser-BkUDpbL9.js";import"./user-Bu1ajp0e.js";const xe={class:"app-container"},Ne=["src"],Ue=_e({name:"Todo"}),Oe=Object.assign(Ue,{setup($e){const{proxy:_}=we(),{flow_status:z,activity_status:Y}=_.useDict("flow_status","activity_status"),U=s(!0),E=s([]),J=s(!0),M=s(!0),$=s(0),D=s([]),Q=s(!0),B=s(""),V=s(!1),A=s(null),b=s(""),P=s(""),k=s(""),v=s(!1),G=me({form:{},queryParams:{pageNum:1,pageSize:10,nodeName:null,flowStatus:null,approver:null,createTime:null},rules:{assigneePermission:[{required:!0,message:"请选择权限标识",trigger:"change"}]},postParams:{}}),{queryParams:i,form:y,rules:Te,postParams:O}=pe(G);function w(){U.value=!0,ye(i.value).then(a=>{D.value=a.rows,$.value=a.total,U.value=!1})}function T(){i.value.pageNum=1,w()}function W(){_.resetForm("queryForm"),T()}function X(a){E.value=a.map(t=>t.id),J.value=a.length!==1,M.value=!a.length}function Z(a){b.value=a.id,P.value=a.businessId,a.formPath||(a.formPath="system/leave/approve.vue"),a.formCustom=="N"&&he(()=>import(`../../../../views/${a.formPath}`),__vite__mapDeps([])).then(t=>{A.value=t.default})}function ee(a){Ve(a).then(t=>{V.value=!0,B.value="data:image/gif;base64,"+t.data})}function x(a,t){y.value.assigneePermission=null,b.value=a.id,k.value=t,be(b.value).then(f=>{y.value.assigneePermission=f.data.assigneePermission?f.data.assigneePermission.split(","):[]}),v.value=!0;let C={转办:"1",加签:"6",委派:"3",减签:"7"};O.value={url:"interactiveTypeSysUser",taskId:a.id,operatorType:C[t]}}function te(a){y.value.assigneePermission=a.map(f=>f.userId);let t=JSON.parse(JSON.stringify(y.value.assigneePermission)),C={转办:"2",加签:"6",委派:"3",减签:"7"};ke(b.value,Array.isArray(t)?t.join(","):t,C[k.value]).then(()=>{_.$modal.msgSuccess(`${k.value}成功`),open.value=!1,w()})}function le(a){_.$modal.confirm('是否确认激活流程编号为"'+a+'"的数据项？').then(function(){return Ce(a)}).then(()=>{w(),_.$modal.msgSuccess("激活成功")}).catch(()=>{})}function ae(a){_.$modal.confirm('是否确认挂起流程编号为"'+a+'"的数据项？').then(function(){return Se(a)}).then(()=>{w(),_.$modal.msgSuccess("挂起成功")}).catch(()=>{})}return w(),(a,t)=>{const C=d("el-input"),f=d("el-form-item"),oe=d("el-option"),ne=d("el-select"),se=d("el-date-picker"),c=d("el-button"),ie=d("el-form"),u=d("el-table-column"),j=d("dict-tag"),re=d("el-table"),ue=d("pagination"),q=d("el-dialog"),S=F("hasPermi"),de=F("loading");return r(),L("div",xe,[g(o(ie,{model:l(i),ref:"queryForm",inline:!0,"label-width":"100px"},{default:n(()=>[o(f,{label:"任务名称",prop:"nodeName"},{default:n(()=>[o(C,{modelValue:l(i).nodeName,"onUpdate:modelValue":t[0]||(t[0]=e=>l(i).nodeName=e),placeholder:"请输入任务名称",clearable:"",onKeyup:ce(T,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),o(f,{label:"流程状态",prop:"flowStatus"},{default:n(()=>[o(ne,{modelValue:l(i).flowStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>l(i).flowStatus=e),placeholder:"请选择流程状态",clearable:""},{default:n(()=>[(r(!0),L(fe,null,ve(l(z),e=>(r(),m(oe,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"创建时间",prop:"createTime"},{default:n(()=>[o(se,{clearable:"",size:"small",modelValue:l(i).createTime,"onUpdate:modelValue":t[2]||(t[2]=e=>l(i).createTime=e),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"选择创建时间"},null,8,["modelValue"])]),_:1}),o(f,null,{default:n(()=>[o(c,{type:"primary",icon:"Search",onClick:T},{default:n(()=>[p("搜索")]),_:1}),o(c,{icon:"Refresh",onClick:W},{default:n(()=>[p("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[R,l(Q)]]),g((r(),m(re,{data:l(D),onSelectionChange:X},{default:n(()=>[o(u,{type:"selection",width:"55",align:"center",fixed:""}),o(u,{label:"序号",width:"55",align:"center"},{default:n(e=>[p(H(e.$index+1),1)]),_:1}),o(u,{label:"id",width:"100",align:"center",prop:"id","show-overflow-tooltip":!0}),o(u,{label:"流程名称",align:"center",prop:"flowName","show-overflow-tooltip":!0}),o(u,{label:"任务名称",align:"center",prop:"nodeName","show-overflow-tooltip":!0}),o(u,{label:"审批人",align:"center",prop:"approver","show-overflow-tooltip":!0}),o(u,{label:"转办人",align:"center",prop:"transferredBy","show-overflow-tooltip":!0}),o(u,{label:"委派人",align:"center",prop:"delegate","show-overflow-tooltip":!0}),o(u,{label:"流程状态",align:"center",prop:"flowStatus","show-overflow-tooltip":!0},{default:n(e=>[o(j,{options:l(z),value:e.row.flowStatus},null,8,["options","value"])]),_:1}),o(u,{label:"激活状态",align:"center",prop:"activityStatus",width:"140",sortable:"custom","show-overflow-tooltip":!0},{default:n(e=>[o(j,{options:l(Y),value:e.row.activityStatus},null,8,["options","value"])]),_:1}),o(u,{label:"创建时间",align:"center",prop:"createTime",width:"160","show-overflow-tooltip":!0},{default:n(e=>[K("span",null,H(a.parseTime(e.row.createTime)),1)]),_:1}),o(u,{label:"操作",align:"center",width:"240",fixed:"right","class-name":"small-padding fixed-width"},{default:n(e=>[g((r(),m(c,{size:"small",type:"text",onClick:h=>Z(e.row)},{default:n(()=>[p("办理")]),_:2},1032,["onClick"])),[[S,["flow:execute:handle"]]]),g((r(),m(c,{size:"small",type:"text",onClick:h=>x(e.row,"转办")},{default:n(()=>[p("转办")]),_:2},1032,["onClick"])),[[S,["flow:execute:handle"]]]),g((r(),m(c,{size:"small",type:"text",onClick:h=>x(e.row,"加签")},{default:n(()=>[p("加签")]),_:2},1032,["onClick"])),[[S,["flow:execute:handle"]]]),g((r(),m(c,{size:"small",type:"text",onClick:h=>x(e.row,"委派")},{default:n(()=>[p("委派")]),_:2},1032,["onClick"])),[[S,["flow:execute:handle"]]]),g((r(),m(c,{size:"small",type:"text",onClick:h=>x(e.row,"减签")},{default:n(()=>[p("减签")]),_:2},1032,["onClick"])),[[S,["flow:execute:handle"]]]),e.row.activityStatus===0?(r(),m(c,{key:0,size:"small",type:"text",onClick:h=>le(e.row.instanceId)},{default:n(()=>[p("激活")]),_:2},1032,["onClick"])):I("",!0),e.row.activityStatus===1?(r(),m(c,{key:1,size:"small",type:"text",onClick:h=>ae(e.row.instanceId)},{default:n(()=>[p("挂起")]),_:2},1032,["onClick"])):I("",!0),o(c,{size:"small",type:"text",onClick:h=>ee(e.row.instanceId)},{default:n(()=>[p("流程图")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,l(U)]]),g(o(ue,{total:l($),page:l(i).pageNum,"onUpdate:page":t[3]||(t[3]=e=>l(i).pageNum=e),limit:l(i).pageSize,"onUpdate:limit":t[4]||(t[4]=e=>l(i).pageSize=e),onPagination:w},null,8,["total","page","limit"]),[[R,l($)>0]]),(r(),m(ge(l(A)),{modelValue:l(P),"onUpdate:modelValue":t[5]||(t[5]=e=>N(P)?P.value=e:null),taskId:l(b),disabled:!1,onRefresh:w},null,40,["modelValue","taskId"])),o(q,{title:"流程图",modelValue:l(V),"onUpdate:modelValue":t[6]||(t[6]=e=>N(V)?V.value=e:null),width:"1100"},{default:n(()=>[K("img",{src:l(B),width:"1000",height:"500",style:{margin:"0 auto"}},null,8,Ne)]),_:1},8,["modelValue"]),l(v)?(r(),m(q,{key:0,title:`${l(k)}用户选择`,modelValue:l(v),"onUpdate:modelValue":t[9]||(t[9]=e=>N(v)?v.value=e:null),width:"80%","append-to-body":""},{default:n(()=>[o(l(Pe),{postParams:l(O),type:l(k),selectUser:l(y).assigneePermission,"onUpdate:selectUser":t[7]||(t[7]=e=>l(y).assigneePermission=e),userVisible:l(v),"onUpdate:userVisible":t[8]||(t[8]=e=>N(v)?v.value=e:null),onHandleUserSelect:te},null,8,["postParams","type","selectUser","userVisible"])]),_:1},8,["title","modelValue"])):I("",!0)])}}});export{Oe as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}